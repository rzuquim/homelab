# NOTE: Instructions from https://docs.gitea.com/installation/install-with-docker-rootless/
- name: Install gitea
  hosts: all
  become: yes

  vars_files:
    - "../global_vars.yml"
    - "{{ '../secrets.yml' if env == 'prod' else '../secrets_' ~ env ~ '.yml' }}"

  vars:
    nginx_static_files_domain: cdn.rzuquim.com
    nginx_sites:
      - { name: "gitea", template: "nginx.gitea.conf" }
      - { name: "cdn", template: "nginx.cdn.conf" }
    nginx_folders:
      - /var/www/html
      - /var/www/cdn

  tasks:
    - import_tasks: nginx.ansible.01_install.yml
    - import_tasks: nginx.ansible.02_config.yml
    - import_tasks: nginx.ansible.03_cdn.yml

  handlers:
    - name: reload_nginx
      service:
        name: nginx
        state: reloaded
